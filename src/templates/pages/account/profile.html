{% extends "common/base.html" %}

{% block title %}Profile{% endblock %}

{% block content %}
    <section class="relative">
        {% if errors %}
            {% include 'components/error_card.html' with title="Some fields are invalid or missing" errors=errors classes="w-full mb-5 p-5" %}
        {% endif %}
        <div class="relative w-full h-64 bg-white rounded-lg primary-gradient"></div>
        <div class="-mt-16 ml-8">
            <div class="relative w-32 h-32 rounded-full bg-white border-4 border-[#000019] overflow-hidden group">
                <form method="POST" action="/api/v1/user/{{ user.id }}/avatar" id="upload-avatar-form" enctype="multipart/form-data">
                    {% csrf_token %}
                    <label
                        id="upload-avatar"
                        class="absolute left-0 top-0 w-32 h-32 bg-white bg-opacity-80 z-1 flex items-center justify-center
                        text-gray-800 cursor-pointer font-semibold opacity-0 invisible group-hover:visible group-hover:opacity-100 duration-200"
                    >
                        Edit avatar
                        <input type="file" name="avatar" id="upload-avatar" class="hidden" onchange="document.getElementById('upload-avatar-form').submit()" />
                    </label>
                </form>
                {% load static %}
                {% if user and user.avatar %}
                    <img src="{{user.avatar}}" width="100%" height="100%" />
                {% else %}
                    <img src="{% static 'assets/user_avatar.jpg' %}" width="100%" height="100%" />
                {% endif %}
            </div>
        </div>
        <div class="px-8 mt-4 flex justify-between items-start gap-8">
            <div>
                <h2 class="text-2xl">{{ user.first_name }} {{ user.last_name }}</h2>
                <div>{{ user.email }}</div>
            </div>
            <div>
                <div>Address:</div>
                <div class="flex">
                    <div>{{ user.address }}</div>
                    {% if user.city %}
                        <div>, {{ user.city }} {{ user.city.zip }}</div>
                    {% endif %}
                    {% if user.country %}
                        <div>, {{ user.country }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="flex items-center gap-5">
                <a href="#"
                   class="block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
                >
                    Edit information
                </a>
                <a href="/logout"
                   class="block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
                >
                    Logout
                </a>
            </div>
        </div>
        <div class="px-8 mt-10">
            <h2 class="my-3 text-xl">
                About you
            </h2>
            <form method="POST" action="/api/v1/user/{{ user.id }}/about">
                {% csrf_token %}
                <textarea name="about" rows="5" class="px-6 py-2 rounded-lg bg-[#6C37BD] shadow-2xl w-full">{{ user.about }}</textarea>
                <button type="submit"
                   class="block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
                >
                    Save about you
                </button>
            </form>
        </div>
        <div class="px-8 mt-10">
            <h2 class="my-3 text-xl">
                Your resume
            </h2>
            {% if user.resume %}
                <div class="bg-[#6C37BD] mt-4 p-4 rounded-lg">
                    {{ user.resume.content }}
                </div>
            {% endif %}
            {% include 'components/cv_modal.html' %}
            <div
                id="add-cv"
               class="w-64 inline-block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
            >
                {% if user.resume %}
                    Update resume
                {% else %}
                    Add resume
                {% endif %}
            </div>
        </div>
        <div class="px-8 mt-10">
            <h2 class="my-3 text-xl">
                Your experience
            </h2>
            <div class="grid grid-cols-3 gap-5">
                {% if user and user.experiences %}
                    {% for experience in user.experiences %}
                        <div class="bg-[#6C37BD] mt-4 p-4 rounded-lg">
                            <div class="grid grid-cols-2 mb-1">
                                <div class="font-medium">Company:</div>
                                <div class="text-right">{{ experience.company }}</div>
                            </div>
                            <div class="grid grid-cols-2">
                                <div class="font-medium">Start date:</div>
                                <div class="text-right">{{ experience.start_date }}</div>
                            </div>
                            <div class="grid grid-cols-2">
                                <div class="font-medium">End date:</div>
                                {% if experience.end_date %}
                                    <div class="text-right">{{ experience.end_date }}</div>
                                {% else %}
                                    <div class="text-right">Still working here</div>
                                {% endif %}
                            </div>
                            <div class="grid grid-cols-2">
                                <div class="font-medium">Role:</div>
                                <div class="text-right">{{ experience.role }}</div>
                            </div>
                            <div class="grid grid-cols-1 mb-1">
                                <div class="font-medium">Job description:</div>
                                <div class="text-left">{{ experience.description }}</div>
                            </div>
                            <div>
                                <a href="/api/v1/user/{{ user.id }}/remove-experience/{{ experience.id }}"
                                   class="block text-center border border-red-400 rounded-full p-1 px-3 text-red-400 text-sm hover:bg-red-400
                                   mt-3 cursor-pointer mt-2 hover:text-white"
                                >
                                    Remove
                                </a>
                            </div>
                        </div>
                    {% endfor %}

                {% endif %}
            </div>
            {% include 'components/experience_modal.html' %}
            <div
                id="add-experience"
                class="w-64 inline-block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
            >
                Add experience
            </div>
        </div>
        <div class="px-8 mt-10">
            <h2 class="my-3 text-xl">
                Your skills
            </h2>
            <div class="grid grid-cols-5 gap-5">
                {% if user and user.skills %}
                    {% for skill in user.skills %}
                        <div class="bg-[#6C37BD] p-4 rounded-lg text-sm flex justify-between items-center">
                            <div class="font-medium">{{ skill.name }}</div>
                            <a href="/api/v1/user/{{ user.id }}/remove-skill/{{ skill.id }}" class="hover:text-red-500 cursor-pointer">
                                {% include 'common/icons/trash.html' with classes='w-5 h-5' %}
                            </a>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
            {% include 'components/skill_modal.html' %}
            <div
               id="add-skill"
               class="w-64 inline-block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-4"
            >
                Add skills
            </div>
        </div>
        <div class="px-8 mt-10">
            <h2 class="my-3 text-xl">
                Your recommendations
            </h2>
            <div class="grid grid-cols-3 gap-5">
                {% if user and user.recommendations %}
                    {% for recommendation in user.recommendations %}
                        <div class="bg-[#6C37BD] mt-4 p-4 rounded-lg">
                            <div class="grid grid-cols-2 mb-1">
                                <div class="font-medium">Contact name:</div>
                                <div class="text-right">{{ recommendation.name }}</div>
                            </div>
                            <div class="grid grid-cols-2 mb-1">
                                <div class="font-medium">Contact email:</div>
                                <div class="text-right">{{ recommendation.email }}</div>
                            </div>
                            <div class="grid grid-cols-2 mb-1">
                                <div class="font-medium">Contact phone:</div>
                                <div class="text-right">{{ recommendation.phone }}</div>
                            </div>
                            <div class="grid grid-cols-2">
                                <div class="font-medium">Position:</div>
                                <div class="text-right">{{ recommendation.position }}</div>
                            </div>
                            <div>
                                <a href="/api/v1/user/{{ user.id }}/remove-recommendation/{{ recommendation.id }}"
                                   class="block text-center border border-red-400 rounded-full p-1 px-3 text-red-400 text-sm hover:bg-red-400
                                   mt-3 cursor-pointer mt-2 hover:text-white"
                                >
                                    Remove
                                </a>
                            </div>
                        </div>
                    {% endfor %}

                {% endif %}
            </div>
            {% include 'components/recommendation_modal.html' %}
            <div id="add-recommendation"
               class="w-64 inline-block text-center border-2 border-[#6C37BD] rounded-full p-1 px-3 text-[#B188EF] text-sm hover:bg-purple-900 mt-3
                    cursor-pointer mt-2"
            >
                Add recommendation
            </div>
        </div>
    </section>

    <section class="mt-10 px-8">
        <h2 class="text-xl mt-20">
            Already applied jobs
        </h2>

        <div class="bg-[#6C37BD] mt-4 p-4 rounded-lg hover:bg-[#380E77]">
            <div class="flex justify-between items-center">
                <span class="font-medium">Manager</span>
                <span class="font-medium">Sidekick Health ehf</span>
                <span>111 Reykjavik</span>
                <span class="bg-purple-800 text-purple-300 px-3 py-1 rounded">Full time</span>
            </div>
        </div>

        <div class="bg-[#6C37BD] mt-4 p-4 rounded-lg hover:bg-[#380E77]">
            <div class="flex justify-between items-center">
                <span class="font-medium">Manager</span>
                <span class="font-medium">Sidekick Health ehf</span>
                <span>111 Reykjavik</span>
                <span class="bg-purple-800 text-purple-300 px-3 py-1 rounded">Full time</span>
            </div>
        </div>
    </section>


{% endblock %}
